<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cart & Checkout</title>
<style>
  :root {
    --bg: #faf9f6;
    --dust-rose: #D6A7A1;
    --olive-gold: #C2B280;
    --muted: #666;
    --card: #fff;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: var(--bg);
    color: #222;
  }
  .wrap {
    width: 100%;
    margin: 0;
    padding: 24px;
  }
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 18px;
  }
  header h1 { font-size: 24px; margin: 0; }

.cartbox {
background: var(--card);
padding: 20px;
border-radius: 10px;
box-shadow: 0 1px 6px rgba(0,0,0,0.04);
}
input, select, textarea {
width: 100%;
padding: 14px;
font-size: 16px;
border: 1px solid #ccc;
border-radius: 6px;
}
textarea { resize: vertical; }
label.small { display: block; margin-bottom: 6px; font-size: 13px; color: #444; }
.btn {
background: var(--dust-rose);
color: #fff;
border: 0;
padding: 10px 14px;
border-radius: 8px;
cursor: pointer;
font-size: 15px;
box-shadow: 0 3px 6px rgba(0,0,0,0.08);
}
.btn:hover { background: var(--olive-gold); transform: scale(1.02); }
.ghost { background: #fff; color: #333; border: 1px solid #ddd; }
.mini { padding: 8px 10px; font-size: 14px; }
.thank {
background: #eaf7eb;
border-radius: 8px;
padding: 18px;
margin-top: 12px;
display: none;
}
.muted { color: var(--muted); font-size: 13px; }
.total-row { display: flex; justify-content: space-between; font-weight: 700; }
.summary { border-top: 1px dashed #eee; margin-top: 10px; padding-top: 10px; }
.cart-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 8px 0; } </style>

</head>
<body>
  <div class="wrap">
    <header><h1>Your Cart</h1></header>

```
<div class="cartbox">
  <div id="cartItemsContainer" class="cart-items"></div>

  <div class="summary">
    <div>Subtotal <span id="subtotalText" style="float:right">Rs. 0</span></div>
    <div>Delivery <span id="deliveryText" style="float:right">Rs. 0</span></div>
    <div class="total-row">Total <span id="totalText">Rs. 0</span></div>
  </div>

  <button id="checkoutBtn" class="btn" style="width:100%;margin-top:10px;">Proceed to Checkout</button>
  <button id="clearCartBtn" class="btn ghost" style="width:100%;margin-top:10px;">Clear cart</button>
  <button id="continueShoppingBtn" class="btn ghost" style="width:100%;margin-top:10px;">← Continue Shopping</button>

  <form id="checkoutForm" style="display:none;margin-top:15px">
    <div>Please provide your details *</div>

    <input name="email" type="email" placeholder="Email Address *" required style="margin-top:10px;">
    <input name="firstName" type="text" placeholder="First Name *" required style="margin-top:10px;">
    <input name="middleName" type="text" placeholder="Middle Name (optional)" style="margin-top:10px;">
    <input name="lastName" type="text" placeholder="Last Name *" required style="margin-top:10px;">
    <input name="phone" type="tel" placeholder="Phone Number *" required style="margin-top:10px;">
    <textarea name="address" rows="2" placeholder="Address Line 1 *" required style="margin-top:10px;"></textarea>
    <input name="city" type="text" placeholder="City / Town *" required style="margin-top:10px;">
    <input name="state" type="text" placeholder="State / Country *" required style="margin-top:10px;">
    <input name="zip" type="text" placeholder="Zip / Postal (optional)" style="margin-top:10px;">

    <label class="small" style="margin-top:10px;">Payment method *</label>
    <select name="paymentMethod" required>
      <option value="cod">Cash on Delivery (COD)</option>
    </select>

    <button type="submit" class="btn" style="width:100%;margin-top:15px;">Place Order</button>
  </form>

  <div id="thankYou" class="thank">
    <h3>Thank you — your order is received</h3>
    <p>We’ll contact you soon for confirmation.</p>
  </div>
</div>
```

  </div>

<script>
const deliveryCharge = 250;
const webhookUrl = "https://mia-proxy-brdi3wror-mias-projects-3a54d5c3.vercel.app/api/proxy";
const webhookSecret = "MIA_ORGANIC_SECRET";

function formatPKR(n){ return 'Rs. ' + Number(n).toFixed(0); }
let cart = JSON.parse(localStorage.getItem('store_cart') || '[]');
function saveCart(){ localStorage.setItem('store_cart', JSON.stringify(cart)); renderCart(); }

function renderCart(){
  const cont = document.getElementById('cartItemsContainer');
  cont.innerHTML = '';
  if(cart.length===0){ cont.innerHTML = '<div class="muted">Your cart is empty.</div>'; return; }
  let subtotal=0;
  cart.forEach((i,idx)=>{
    const row=document.createElement('div');
    row.className='cart-row';
    const itemTotal=i.price*i.qty; subtotal+=itemTotal;
    row.innerHTML=`<div><b>${i.name}</b><div class="muted">${formatPKR(i.price)} × ${i.qty}</div></div>
      <div>${formatPKR(itemTotal)}<div><button class="ghost mini" onclick="decreaseQty(${idx})">−</button>
      <button class="ghost mini" onclick="increaseQty(${idx})">+</button>
      <button class="ghost mini" onclick="removeItem(${idx})">Remove</button></div></div>`;
    cont.appendChild(row);
  });
  document.getElementById('subtotalText').innerText=formatPKR(subtotal);
  document.getElementById('deliveryText').innerText=formatPKR(deliveryCharge);
  document.getElementById('totalText').innerText=formatPKR(subtotal+deliveryCharge);
}
function increaseQty(i){cart[i].qty++;saveCart();}
function decreaseQty(i){if(cart[i].qty>1)cart[i].qty--;else cart.splice(i,1);saveCart();}
function removeItem(i){cart.splice(i,1);saveCart();}

document.addEventListener('DOMContentLoaded',()=>{
  renderCart();
  document.getElementById('checkoutBtn').onclick=()=>{if(cart.length===0)return alert('Your cart is empty');document.getElementById('checkoutForm').style.display='block';};
  document.getElementById('clearCartBtn').onclick=()=>{if(confirm('Clear cart?')){cart=[];saveCart();}};
  document.getElementById('continueShoppingBtn').onclick=()=>{if(history.length>1)history.back();else location.href='https://sites.google.com/view/miaorganic/shop-online';};
});

function collectOrderData(form){
  const f=n=>form.querySelector(`[name="${n}"]`)?.value||"";
  const customer={email:f("email"),firstName:f("firstName"),middleName:f("middleName"),lastName:f("lastName"),phone:f("phone"),address:f("address"),city:f("city"),state:f("state"),zip:f("zip"),paymentMethod:f("paymentMethod")};
  const items=cart.map(i=>`${i.name} x${i.qty} (${i.price})`).join(" | ");
  const subtotal=cart.reduce((s,it)=>s+it.price*it.qty,0);
  return { ...customer, items, subtotal, deliveryCharge, total:subtotal+deliveryCharge, createdAt:new Date().toISOString() };
}

document.getElementById('checkoutForm').addEventListener('submit',async e=>{
  e.preventDefault();
  if(cart.length===0)return alert('Cart is empty');
  const order=collectOrderData(e.target);

  await fetch(webhookUrl,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({secret:webhookSecret,order})
  }).then(r=>r.json()).then(d=>console.log('Sent to sheet:',d)).catch(err=>console.error(err));

  cart=[];saveCart();
  document.getElementById('checkoutForm').style.display='none';
  document.getElementById('thankYou').style.display='block';
});
</script>

</body>
</html>

